var fileObjectId="",newDiv=null,divwhtk=document.getElementById("csswhtk");if(null!=divwhtk){var inputwhtk=document.getElementById("inputwhtk"),owhtk=document.getElementById("myupload");console.log(owhtk);var awhtk=owhtk.getElementsByTagName("input")[0];console.log(awhtk),loadingWindow(),owhtk.onclick=function(){console.log("yy"),awhtk.click()},awhtk.onchange=function(){inputwhtk.innerText=awhtk.files[0].name}}function loadingWindow(){null==divwhtk&&(divwhtk=document.getElementById("csswhtk")),console.log(divwhtk.offsetTop);divwhtk.offsetLeft;null==newDiv&&((newDiv=document.createElement("div")).innerHTML="<img style=“overflow:auto; src='/images/loading1.gif'></img> 上传中... ",newDiv.style.cssText="display:block; position:relative; width:100%; height:100%;border:3px solid orange;background-color:#FFF8DC ; overflow:auto; text-align: center;")}function fanhui(e){divwhtk.innerHTML='<label  id="labelwhtk">学号</label>    <input id="xuehao" type="text" name="xuehao"/> <br> \n<label  id="labelwhtk2">姓名</label>    <input id="xingming" type="text" name="xingming"/> <br> \n<label  id="inputwhtk">请选择文件</label>  <span  className = "myupload"    id = "myupload">\n       <em> 添加文件 </em>\n    <input id="fileupload" type="file" name="file1" style="display:none"/>\n</span> <input type="button" value="上传" onclick="upload()"/>',inputwhtk=document.getElementById("inputwhtk"),owhtk=document.getElementById("myupload"),awhtk=owhtk.getElementsByTagName("input")[0],loadingWindow(),owhtk.onclick=function(){console.log("yy"),awhtk.click()},awhtk.onchange=function(){inputwhtk.innerText=awhtk.files[0].name}}function delyunfile(e){alert(e);AV.File.createWithoutData(e).destroy(),alert("已删除"),divwhtk.innerHTML='<label  id="labelwhtk">学号</label>    <input id="xuehao" type="text" name="xuehao"/> <br> \n<label  id="labelwhtk2">姓名</label>    <input id="xingming" type="text" name="xingming"/> <br> \n<label  id="inputwhtk">请选择文件</label>  <span  className = "myupload"    id = "myupload">\n       <em> 添加文件 </em>\n    <input id="fileupload" type="file" name="file1" style="display:none"/>\n</span> <input type="button" value="上传" onclick="upload()"/>',inputwhtk=document.getElementById("inputwhtk"),owhtk=document.getElementById("myupload"),awhtk=owhtk.getElementsByTagName("input")[0],loadingWindow(),owhtk.onclick=function(){console.log("yy"),awhtk.click()},awhtk.onchange=function(){inputwhtk.innerText=awhtk.files[0].name}}function upload(){var e=document.getElementById("xuehao"),t=document.getElementById("xingming");if(""==e.value.trim()||""==t.value.trim())return inputwhtk.innerText="请选择文件",awhtk.value="",void alert("学号或姓名不能为空");if("2002"!=e.value.trim().substring(0,4)&&6!=e.value.length)return inputwhtk.innerText="请选择文件",awhtk.value="",void alert("学号有错");if(""!=awhtk.value){var n=document.getElementById("fileupload");if(n.files.length){var l=n.files[0].name+"";console.log(typeof l),console.log(l.lastIndexOf(".")+1),console.log(l.substring(l.lastIndexOf(".")+1,l.length));var i=t.value.trim()+"-"+e.value.trim()+"-"+document.title,o=e.value.trim()+"-"+document.title,a="",u="",d=new AV.Query("_File");d.contains("name",o),console.log(d);d.find().then((e=>{if(console.log(e),e.length>0)console.log(e[0].id),alert("你已经上传过了,请先删除"),!0,console.log(e[0].id),u=e[0].id,i=e[0].attributes.name,a=e[0].attributes.url,divwhtk.innerHTML="<a id=\"yunfile\"  target='_blank' href="+a+">"+i+'</a> <br><input type="button" value="删除" onclick=delyunfile(\''+u+'\')></input><input type="button" value="返回" onclick=fanhui()></input>',i="",n="",!1,a="",u="",d="";else{var t=new AV.File(i,n.files[0]),l=!0;t.save({onprogress:e=>{null==newDiv&&loadingWindow(),console.log(l),console.log(divwhtk),console.log(newDiv),l&&(divwhtk.innerHTML=newDiv.outerHTML,l=!1)}}).then((e=>{l=!0,console.log(e.url()),u=t.id,divwhtk.innerHTML="<a id=\"yunfile\"  target='_blank' href="+e.url()+">"+i+'</a> <br><input type="button" value="删除" onclick=delyunfile(\''+u+'\')></input><input type="button" value="返回" onclick=fanhui()></input>',i="",e="",!1,a="",u="",d=""})).catch(console.error)}}))}}else alert("请选择一个文件")}